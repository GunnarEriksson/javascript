/**
 * Work with strings.
 */
$(document).ready(function () {
    "use strict";

    var guerTheGeek = document.getElementById("baddie1");
    var area = document.getElementById("game-wrapper");
    var posLeft = 0;
    var posTop = 0;
    var tileSize = 32;
    var gridSize = 24;
    var top;
    var left;

    /**
     * This is the background for the game area.
     */
    var gameArea = [
      13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,
      12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,
      14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,
      13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,
      12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,
      14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,
      13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,
      12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,
      14,12,13,14,12,13,14,13,13,14,12,13,14,12,13,14,12,13,14,12,13,14,12,13,
      13,14,12,13,14,12,13,14,13,14,14,14,13,12,12,13,14,12,13,14,12,13,14,12,
      12,13,14,12,13,14,12,16,15,15,21,14,12,16,15,15,21,14,12,13,14,12,13,14,
      14,12,13,14,12,13,16,18,18,18,18,15,15,18,18,18,18,21,14,12,13,14,12,13,
      13,14,12,13,14,12,19,20,20,20,20,20,20,20,20,20,20,22,13,14,12,13,14,12,
      12,13,14,12,13,14,12,13,14,12,13,14,12,14,14,12,13,14,12,13,14,12,13,14,
      14,12,13,14,12,13,14,12,12,12,14,14,13,12,13,14,12,13,14,12,13,14,12,13,
      13,14,12,13,14,12,13,14,12,14,14,12,13,14,12,13,14,12,13,14,12,13,14,12,
      12,13,14,12,13,14,12,13,12,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,
      14,12,13,14,12,13,14,12,12,12,14,14,13,12,13,14,12,13,14,12,13,14,12,13,
      13,14,12,13,14,12,13,14,12,14,14,12,13,14,12,13,14,12,13,14,12,13,14,12,
      12,13,14,12,13,14,12,13,12,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,
      14,12,13,14,12,13,14,12,12,12,14,14,13,12,13,14,12,13,14,12,13,14,12,13,
      13,14,12,13,14,12,13,14,12,14,14,12,13,14,12,13,14,12,13,14,12,13,14,12,
      12,13,14,12,13,14,12,13,12,12,13,14,12,13,14,12,13,14,12,13,14,12,13,14,
      14,12,13,14,12,13,14,12,12,12,14,14,13,12,13,14,12,13,14,12,13,14,12,13];

    /**
     * These are blocks that cant be moved to, or something happens when you try to move on them.
     * The blocks are drawn "on top" of the gamearea. Block 10 is empty, should be 0 but looks nicer with two figures.
     */
    var gameBlocks = [
      11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,
      11,10,10,10,10,10,10,10,10,10,10,11,11,10,10,10,10,10,10,10,10,10,10,11,
      11,10,10,10,10,10,10,10,10,10,10,11,11,10,10,10,10,10,10,10,10,10,10,11,
      11,10,10,11,11,10,11,11,11,10,10,11,11,10,10,11,11,11,10,11,11,10,10,11,
      11,10,10,11,11,10,11,11,11,10,10,11,11,10,10,11,11,11,10,11,11,10,10,11,
      11,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,
      11,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,
      11,10,10,11,11,10,11,10,11,11,11,11,11,11,11,11,10,11,10,11,11,10,10,11,
      11,10,10,10,10,10,11,10,10,10,10,11,11,10,10,10,10,11,10,10,10,10,10,11,
      11,10,10,10,10,10,11,11,11,10,10,11,11,10,10,11,11,11,10,10,10,10,10,11,
      11,11,11,11,11,10,11,10,10,10,10,11,11,10,10,10,10,11,10,11,11,11,11,11,
      11,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,
      11,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,
      11,11,11,11,11,10,11,10,11,11,11,11,11,11,11,11,10,11,10,11,11,11,11,11,
      11,10,10,10,10,10,11,10,10,10,10,11,11,10,10,10,10,11,10,10,10,10,10,11,
      11,10,10,10,10,10,10,10,10,10,10,11,11,10,10,10,10,10,10,10,10,10,10,11,
      11,10,11,11,11,10,11,11,11,10,10,11,11,10,10,11,11,11,10,11,11,11,10,11,
      11,10,10,10,11,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,10,10,10,11,
      11,11,11,10,11,10,11,10,11,11,11,11,11,11,11,11,10,11,10,11,10,11,11,11,
      11,10,10,10,10,10,11,10,10,10,10,11,11,10,10,10,10,11,10,10,10,10,10,11,
      11,10,10,10,10,10,11,10,10,10,10,11,11,10,10,10,10,11,10,10,10,10,10,11,
      11,10,11,11,11,11,11,11,11,10,10,11,11,10,10,11,11,11,11,11,11,11,10,11,
      11,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,
      11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11];

    /**
     * Draw the initial gameplan
     */
    function drawGamePlan(gameArea, gameBlocks) {
        var i;
        var element;

        for (i = 0; i < gameArea.length; i += 1) {
            element = document.createElement("div");
            element.innerHTML = "";
            element.className = "tile t" + gameArea[i] + (gameBlocks[i] ? " b" + gameBlocks[i] : "");
            element.id = "n" + i;
            area.appendChild(element);
        }
    }

    /**
     * Move Guer the Geek
     */
    var move = function (moveLeft, moveTop, which) {
        var canMove;
        console.log("moveLeft: " + moveLeft + ", moveTop: " + moveTop + ", which: " + which);

        function moveIt() {
            left = posLeft * tileSize;
            top = posTop * tileSize;

            guerTheGeek.style.left = left + "px";
            guerTheGeek.style.top = top + "px";
        }

        if (which) {
            guerTheGeek.className = "baddie " + which;
        }

        canMove = gameBlocks[(posLeft + moveLeft) + (posTop + moveTop) * gridSize] - 10;
        if (!canMove) {
            posLeft += moveLeft;
            posTop += moveTop;
            moveIt();
        } else {
            console.log("Block detected, cant move.");
        }
    };

    /**
     * Keep track on keys pressed and move Guer the Geek accordingly.
     */
    document.onkeydown = function (event) {
        var key;
        key = event.keyCode || event.which;

        switch (key) {
        case 37:
            move(-1, 0, "left");
            break;
        case 39:
            move(1, 0, "right");
            break;
        case 38:
            move(0, -1, "up");
            break;
        case 40:
            move(0, 1, "down");
            break;
        default:
            move(0, 0, "down");
        }

        // Prevent scrolling with the arrow keys
        if ([37, 38, 39, 40].indexOf(event.keyCode) > -1) {
            event.preventDefault();
        }
    };

    console.log("Drawing gameplan.");
    drawGamePlan(gameArea, gameBlocks);

    console.log("Moving Guer the Geek to initial spot.");
    move(1, 1, "down");

    console.log("Boulder dash game is ready.");
});
